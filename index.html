<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>My Karaoke List</title>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.basic.min.js"></script>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; padding: 20px; background: #f8f9fa; color: #333; }
        .controls { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        #searchInput { flex-grow: 1; min-width: 200px; }
        .card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #ff4757; }
        .card h3 { margin: 0 0 5px 0; color: #2f3542; font-size: 1.2em; }
        .artist { color: #57606f; font-weight: bold; margin-bottom: 10px; display: block; }
        .furigana { font-size: 0.75em; color: #a4b0be; display: block; margin-top: -5px; }
        .tags-container { margin: 10px 0; }
        .tag { background: #f1f2f6; color: #57606f; padding: 3px 10px; border-radius: 15px; font-size: 0.8em; margin-right: 5px; border: 1px solid #dfe4ea; }
        .genre { font-size: 0.85em; color: #747d8c; background: #f1f2f6; padding: 2px 8px; border-radius: 4px; }
        .yt-link { display: inline-block; margin-top: 10px; color: #ff0000; text-decoration: none; font-size: 0.9em; font-weight: bold; }
        .yt-link:hover { text-decoration: underline; }
        .remarks { font-size: 0.9em; color: #2f3542; background: #fffaf0; padding: 10px; border-radius: 5px; margin-top: 10px; border: 1px dashed #ffd32a; }
    </style>
</head>
<body>

    <h1>ğŸ¤ My Karaoke List</h1>

    <div class="controls">
        <input type="text" id="searchInput" placeholder="æ›²åã€ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€å‚™è€ƒã‚’æ¤œç´¢...">
        <select id="tagFilter"><option value="">ã™ã¹ã¦ã®ã‚¿ã‚°</option></select>
        <select id="genreFilter"><option value="">ã™ã¹ã¦ã®ã‚¸ãƒ£ãƒ³ãƒ«</option></select>
    </div>

    <div id="results">èª­ã¿è¾¼ã¿ä¸­...</div>

<script>
let database = [];
const resultsElement = document.getElementById('results');

// 1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
fetch('data.json')
    .then(res => res.json())
    .then(data => {
        database = data;
        setupFilters(data);
        render();
    });

function setupFilters(data) {
    const tags = new Set();
    const genres = new Set();
    data.forEach(item => {
        (item.tags || []).forEach(t => tags.add(t));
        if(item.ã‚¸ãƒ£ãƒ³ãƒ«) genres.add(item.ã‚¸ãƒ£ãƒ³ãƒ«);
    });
    
    const tagSel = document.getElementById('tagFilter');
    tags.forEach(t => { const op = document.createElement('option'); op.value = op.textContent = t; tagSel.appendChild(op); });
    
    const genSel = document.getElementById('genreFilter');
    genres.forEach(g => { const op = document.createElement('option'); op.value = op.textContent = g; genSel.appendChild(op); });
}

function render() {
    let filtered = [...database];
    const keyword = document.getElementById('searchInput').value;
    const tag = document.getElementById('tagFilter').value;
    const genre = document.getElementById('genreFilter').value;

    if (keyword) {
        // æ¤œç´¢å¯¾è±¡ã‚’å®Ÿæƒ…ã«åˆã‚ã›ã¦è¨­å®š
        const fuse = new Fuse(filtered, { keys: ['æ›²å', 'ãƒ•ãƒªã‚¬ãƒŠ', 'ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ', 'å‚™è€ƒ'] });
        filtered = fuse.search(keyword).map(r => r.item);
    }
    if (tag) filtered = filtered.filter(item => (item.tags || []).includes(tag));
    if (genre) filtered = filtered.filter(item => item.ã‚¸ãƒ£ãƒ³ãƒ« === genre);

    resultsElement.innerHTML = filtered.map(item => `
        <div class="card">
            <span class="furigana">${item.ãƒ•ãƒªã‚¬ãƒŠ || ''}</span>
            <h3>${item.æ›²å || 'ç„¡é¡Œ'}</h3>
            <span class="artist">ğŸ‘¤ ${item.ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ || 'ä¸æ˜'}</span>
            <span class="genre">ğŸ“‚ ${item.ã‚¸ãƒ£ãƒ³ãƒ« || 'æœªåˆ†é¡'}</span>
            
            <div class="tags-container">
                ${(item.tags || []).map(t => `<span class="tag">#${t}</span>`).join('')}
            </div>

            ${item.å‚™è€ƒ ? `<div class="remarks">ğŸ’¡ ${item.å‚™è€ƒ}</div>` : ''}
            
            ${item.ã‚«ãƒ©ã‚ªã‚±éŸ³æºã®YoutubeURL ? 
                `<a href="${item.ã‚«ãƒ©ã‚ªã‚±éŸ³æºã®YoutubeURL}" target="_blank" class="yt-link">â–¶ï¸ YouTubeéŸ³æºã§ç·´ç¿’</a>` : ''}
        </div>
    `).join('') || '<p>è©²å½“ã™ã‚‹æ›²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
}

document.getElementById('searchInput').oninput = render;
document.getElementById('tagFilter').onchange = render;
document.getElementById('genreFilter').onchange = render;
</script>
</body>
</html>